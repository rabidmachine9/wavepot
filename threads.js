!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).threads=e()}}((function(){return function e(t,r,n){function s(i,a){if(!r[i]){if(!t[i]){var u="function"==typeof require&&require;if(!a&&u)return u(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[i]={exports:{}};t[i][0].call(l.exports,(function(e){return s(t[i][1][e]||e)}),l,l.exports,e,t,r,n)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)s(n[i]);return s}({1:[function(e,t,r){},{}],2:[function(e,t,r){var n,s,o=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{s="function"==typeof clearTimeout?clearTimeout:a}catch(e){s=a}}();var c,l=[],f=!1,d=-1;function p(){f&&c&&(f=!1,c.length?l=c.concat(l):d=-1,l.length&&h())}function h(){if(!f){var e=u(p);f=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,f=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===a||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function b(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new b(e,t)),1!==l.length||f||u(h)},b.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.rehydrateError=function(e){return Object.assign(Error(e.message),{name:e.name,stack:e.stack})},r.serializeError=function(e){return{message:e.message,name:e.name,stack:e.stack}}},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}(e("./master/index"));var n=e("./worker/index");r.expose=n.expose;var s=e("./transferable");r.Transfer=s.Transfer},{"./master/index":8,"./transferable":17,"./worker/index":22}],5:[function(e,t,r){"use strict";let n;function s(e){return(""+e).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/,"$1")+"/"}Object.defineProperty(r,"__esModule",{value:!0}),r.getBundleURL=function(){return n||(n=function(){try{throw new Error}catch(e){const t=(""+e.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return s(t[0])}return"/"}()),n},r.getBaseURL=s},{}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./get-bundle-url.browser");r.defaultPoolSize="undefined"!=typeof navigator&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:4;const s=e=>/^(file|https?:)?\/\//i.test(e);function o(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}r.selectWorkerImplementation=function(){return"undefined"==typeof Worker?class{constructor(){throw Error("No web worker implementation available. You might have tried to spawn a worker within a worker in a browser that doesn't support workers in workers.")}}:class extends Worker{constructor(e,t){"string"==typeof e&&t&&t._baseURL?e=new URL(e,t._baseURL):"string"==typeof e&&!s(e)&&n.getBundleURL().match(/^file:\/\//i)&&(e=new URL(e,n.getBundleURL().replace(/\/[^\/]+$/,"/")),e=o(`importScripts(${JSON.stringify(e)});`)),"string"==typeof e&&s(e)&&(e=o(`importScripts(${JSON.stringify(e)});`)),super(e,t)}}}},{"./get-bundle-url.browser":5}],7:[function(e,t,r){(function(t){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(r,"__esModule",{value:!0});const s=n(e("./implementation.browser")),o=n(e("./implementation.node")),i=void 0!==t&&"browser"!==t.arch&&"pid"in t?o:s;r.defaultPoolSize=i.defaultPoolSize,r.selectWorkerImplementation=i.selectWorkerImplementation}).call(this,e("_process"))},{"./implementation.browser":6,"./implementation.node":1,_process:2}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./implementation");var s=e("./pool");r.Pool=s.Pool;var o=e("./spawn");r.spawn=o.spawn;var i=e("./thread");r.Thread=i.Thread,r.Worker=n.selectWorkerImplementation()},{"./implementation":7,"./pool":11,"./spawn":12,"./thread":13}],9:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const s=n(e("debug")),o=e("observable-fns"),i=e("../common"),a=e("../observable-promise"),u=e("../transferable"),c=e("../types/messages"),l=s.default("threads:master:messages");let f=1;const d=e=>Array.from(new Set(e)),p=e=>e&&e.type===c.WorkerMessageType.error,h=e=>e&&e.type===c.WorkerMessageType.result,b=e=>e&&e.type===c.WorkerMessageType.running;function m(e,t){return(...r)=>{const n=f++,{args:s,transferables:m}=function(e){if(0===e.length)return{args:[],transferables:[]};const t=[],r=[];for(const n of e)u.isTransferDescriptor(n)?(t.push(n.send),r.push(...n.transferables)):t.push(n);return{args:t,transferables:0===r.length?r:d(r)}}(r),y={type:c.MasterMessageType.run,uid:n,method:t,args:s};return l("Sending command to run function to worker:",y),e.postMessage(y,m),a.ObservablePromise.from(o.multicast(function(e,t){return new o.Observable(r=>{let n;const s=o=>{if(l("Message from worker:",o.data),o.data&&o.data.uid===t)if(b(o.data))n=o.data.resultType;else if(h(o.data))"promise"===n?(void 0!==o.data.payload&&r.next(o.data.payload),r.complete(),e.removeEventListener("message",s)):(o.data.payload&&r.next(o.data.payload),o.data.complete&&(r.complete(),e.removeEventListener("message",s)));else if(p(o.data)){const t=i.rehydrateError(o.data.error);r.error(t),e.removeEventListener("message",s)}};return e.addEventListener("message",s),()=>e.removeEventListener("message",s)})}(e,n)))}}r.createProxyFunction=m,r.createProxyModule=function(e,t){const r={};for(const n of t)r[n]=m(e,n);return r}},{"../common":3,"../observable-promise":14,"../transferable":17,"../types/messages":19,debug:23,"observable-fns":41}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e){e.initialized="initialized",e.taskCanceled="taskCanceled",e.taskCompleted="taskCompleted",e.taskFailed="taskFailed",e.taskQueued="taskQueued",e.taskQueueDrained="taskQueueDrained",e.taskStart="taskStart",e.terminated="terminated"}(r.PoolEventType||(r.PoolEventType={}))},{}],11:[function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}u((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const o=s(e("debug")),i=e("observable-fns"),a=e("./implementation"),u=e("./pool-types");r.PoolEventType=u.PoolEventType;const c=e("./thread");r.Thread=c.Thread;let l=1;class f{constructor(e,t){this.eventSubject=new i.Subject,this.initErrors=[],this.isClosing=!1,this.nextTaskID=1,this.taskQueue=[];const r="number"==typeof t?{size:t}:t||{},{size:n=a.defaultPoolSize}=r;var s;this.debug=o.default(`threads:pool:${s=r.name||String(l++),s.replace(/\W/g," ").trim().replace(/\s+/g,"-")}`),this.options=r,this.workers=function(e,t){return function(e){const t=[];for(let r=0;r<e;r++)t.push(r);return t}(t).map(()=>({init:e(),runningTasks:[]}))}(e,n),this.eventObservable=i.multicast(i.Observable.from(this.eventSubject)),Promise.all(this.workers.map(e=>e.init)).then(()=>this.eventSubject.next({type:u.PoolEventType.initialized,size:this.workers.length}),e=>{this.debug("Error while initializing pool worker:",e),this.eventSubject.error(e),this.initErrors.push(e)})}findIdlingWorker(){const{concurrency:e=1}=this.options;return this.workers.find(t=>t.runningTasks.length<e)}runPoolTask(e,t){return n(this,void 0,void 0,(function*(){const r=this.workers.indexOf(e)+1;this.debug(`Running task #${t.id} on worker #${r}...`),this.eventSubject.next({type:u.PoolEventType.taskStart,taskID:t.id,workerID:r});try{const n=yield t.run(yield e.init);this.debug(`Task #${t.id} completed successfully`),this.eventSubject.next({type:u.PoolEventType.taskCompleted,returnValue:n,taskID:t.id,workerID:r})}catch(e){this.debug(`Task #${t.id} failed`),this.eventSubject.next({type:u.PoolEventType.taskFailed,taskID:t.id,error:e,workerID:r})}}))}run(e,t){return n(this,void 0,void 0,(function*(){const r=(()=>n(this,void 0,void 0,(function*(){var n;yield(n=0,new Promise(e=>setTimeout(e,n)));try{yield this.runPoolTask(e,t)}finally{e.runningTasks=e.runningTasks.filter(e=>e!==r),this.isClosing||this.scheduleWork()}})))();e.runningTasks.push(r)}))}scheduleWork(){this.debug("Attempt de-queueing a task in order to run it...");const e=this.findIdlingWorker();if(!e)return;const t=this.taskQueue.shift();if(!t)return this.debug("Task queue is empty"),void this.eventSubject.next({type:u.PoolEventType.taskQueueDrained});this.run(e,t)}taskCompletion(e){return new Promise((t,r)=>{const n=this.events().subscribe(s=>{s.type===u.PoolEventType.taskCompleted&&s.taskID===e?(n.unsubscribe(),t(s.returnValue)):s.type===u.PoolEventType.taskFailed&&s.taskID===e?(n.unsubscribe(),r(s.error)):s.type===u.PoolEventType.terminated&&(n.unsubscribe(),r(Error("Pool has been terminated before task was run.")))})})}completed(e=!1){return n(this,void 0,void 0,(function*(){const t=()=>(function(e,t){return e.reduce((e,r)=>[...e,...t(r)],[])})(this.workers,e=>e.runningTasks);return this.initErrors.length>0?Promise.reject(this.initErrors[0]):e&&0===this.taskQueue.length?Promise.all(t()):(yield new Promise((e,t)=>{const r=this.eventObservable.subscribe({next(n){n.type===u.PoolEventType.taskQueueDrained?(r.unsubscribe(),e()):n.type===u.PoolEventType.taskFailed&&(r.unsubscribe(),t(n.error))},error:t})}),void(yield Promise.all(t())))}))}events(){return this.eventObservable}queue(e){const{maxQueuedJobs:t=1/0}=this.options;if(this.isClosing)throw Error("Cannot schedule pool tasks after terminate() has been called.");if(this.initErrors.length>0)throw this.initErrors[0];const r=()=>this.taskCompletion(s.id);let n;const s={id:this.nextTaskID++,run:e,cancel:()=>{-1!==this.taskQueue.indexOf(s)&&(this.taskQueue=this.taskQueue.filter(e=>e!==s),this.eventSubject.next({type:u.PoolEventType.taskCanceled,taskID:s.id}))},get then(){if(!n){const e=r();n=e.then.bind(e)}return n}};if(this.taskQueue.length>=t)throw Error("Maximum number of pool tasks queued. Refusing to queue another one.\nThis usually happens for one of two reasons: We are either at peak workload right now or some tasks just won't finish, thus blocking the pool.");return this.debug(`Queueing task #${s.id}...`),this.taskQueue.push(s),this.eventSubject.next({type:u.PoolEventType.taskQueued,taskID:s.id}),this.scheduleWork(),s}terminate(e){return n(this,void 0,void 0,(function*(){this.isClosing=!0,e||(yield this.completed(!0)),this.eventSubject.next({type:u.PoolEventType.terminated,remainingQueue:[...this.taskQueue]}),this.eventSubject.complete(),yield Promise.all(this.workers.map(e=>n(this,void 0,void 0,(function*(){return c.Thread.terminate(yield e.init)}))))}))}}function d(e,t){return new f(e,t)}f.EventType=u.PoolEventType,d.EventType=u.PoolEventType,r.Pool=d},{"./implementation":7,"./pool-types":10,"./thread":13,debug:23,"observable-fns":41}],12:[function(e,t,r){(function(t){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}u((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const o=s(e("debug")),i=e("observable-fns"),a=e("../common"),u=e("../promise"),c=e("../symbols"),l=e("../types/master"),f=e("./invocation-proxy"),d=o.default("threads:master:messages"),p=o.default("threads:master:spawn"),h=o.default("threads:master:thread-utils"),b=e=>e&&"init"===e.type,m=e=>e&&"uncaughtError"===e.type,y=void 0!==t&&t.env.THREADS_WORKER_INIT_TIMEOUT?Number.parseInt(t.env.THREADS_WORKER_INIT_TIMEOUT,10):1e4;function v(e,t,r,n){const s=r.filter(e=>e.type===l.WorkerEventType.internalError).map(e=>e.error);return Object.assign(e,{[c.$errors]:s,[c.$events]:r,[c.$terminate]:n,[c.$worker]:t})}r.spawn=function(e){return n(this,void 0,void 0,(function*(){p("Initializing new thread");const t=(yield function(e,t,r){return n(this,void 0,void 0,(function*(){let n;const s=new Promise((e,s)=>{n=setTimeout(()=>s(Error(r)),t)}),o=yield Promise.race([e,s]);return clearTimeout(n),o}))}(function(e){return new Promise((t,r)=>{const n=s=>{d("Message from worker before finishing initialization:",s.data),b(s.data)?(e.removeEventListener("message",n),t(s.data)):m(s.data)&&(e.removeEventListener("message",n),r(a.rehydrateError(s.data.error)))};e.addEventListener("message",n)})}(e),y,`Timeout: Did not receive an init message from worker after ${y}ms. Make sure the worker calls expose().`)).exposed,{termination:r,terminate:s}=function(e){const[t,r]=u.createPromiseWithResolver();return{terminate:()=>n(this,void 0,void 0,(function*(){h("Terminating worker"),yield e.terminate(),r()})),termination:t}}(e),o=function(e,t){return new i.Observable(r=>{const n=e=>{const t={type:l.WorkerEventType.message,data:e.data};r.next(t)},s=e=>{h("Unhandled promise rejection event in thread:",e);const t={type:l.WorkerEventType.internalError,error:Error(e.reason)};r.next(t)};e.addEventListener("message",n),e.addEventListener("unhandledrejection",s),t.then(()=>{const t={type:l.WorkerEventType.termination};e.removeEventListener("message",n),e.removeEventListener("unhandledrejection",s),r.next(t),r.complete()})})}(e,r);if("function"===t.type){return v(f.createProxyFunction(e),e,o,s)}if("module"===t.type){return v(f.createProxyModule(e,t.methods),e,o,s)}{const e=t.type;throw Error(`Worker init message states unexpected type of expose(): ${e}`)}}))}}).call(this,e("_process"))},{"../common":3,"../promise":15,"../symbols":16,"../types/master":18,"./invocation-proxy":9,_process:2,debug:23,"observable-fns":41}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("../symbols");function s(e){throw Error(e)}r.Thread={errors:e=>e[n.$errors]||s("Error observable not found. Make sure to pass a thread instance as returned by the spawn() promise."),events:e=>e[n.$events]||s("Events observable not found. Make sure to pass a thread instance as returned by the spawn() promise."),terminate:e=>e[n.$terminate]()}},{"../symbols":16}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("observable-fns"),s=()=>void 0,o=e=>e,i=e=>Promise.resolve().then(e);function a(e){throw e}class u extends n.Observable{constructor(e){super(t=>{const r=this,n=Object.assign(Object.assign({},t),{complete(){t.complete(),r.onCompletion()},error(e){t.error(e),r.onError(e)},next(e){t.next(e),r.onNext(e)}});try{return this.initHasRun=!0,e(n)}catch(e){n.error(e)}}),this.initHasRun=!1,this.fulfillmentCallbacks=[],this.rejectionCallbacks=[],this.firstValueSet=!1,this.state="pending"}onNext(e){this.firstValueSet||(this.firstValue=e,this.firstValueSet=!0)}onError(e){this.state="rejected",this.rejection=e;for(const t of this.rejectionCallbacks)i(()=>t(e))}onCompletion(){this.state="fulfilled";for(const e of this.fulfillmentCallbacks)i(()=>e(this.firstValue))}then(e,t){const r=e||o,n=t||a;let s=!1;return new Promise((e,t)=>{const o=r=>{if(!s){s=!0;try{e(n(r))}catch(e){t(e)}}};return this.initHasRun||this.subscribe({error:o}),"fulfilled"===this.state?e(r(this.firstValue)):"rejected"===this.state?(s=!0,e(n(this.rejection))):(this.fulfillmentCallbacks.push(t=>{try{e(r(t))}catch(e){o(e)}}),void this.rejectionCallbacks.push(o))})}catch(e){return this.then(void 0,e)}finally(e){const t=e||s;return this.then(e=>(t(),e),()=>t())}}r.ObservablePromise=u},{"observable-fns":41}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=()=>void 0;r.createPromiseWithResolver=function(){let e,t=!1,r=n;return[new Promise(n=>{t?n(e):r=n}),n=>{t=!0,e=n,r()}]}},{}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.$errors=Symbol("thread.errors"),r.$events=Symbol("thread.events"),r.$terminate=Symbol("thread.terminate"),r.$transferable=Symbol("thread.transferable"),r.$worker=Symbol("thread.worker")},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./symbols");r.isTransferDescriptor=function(e){return e&&"object"==typeof e&&e[n.$transferable]},r.Transfer=function(e,t){if(!t){if(!(r=e)||"object"!=typeof r)throw Error();t=[e]}var r;return{[n.$transferable]:!0,send:e,transferables:t}}},{"./symbols":16}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});e("../symbols");!function(e){e.internalError="internalError",e.message="message",e.termination="termination"}(r.WorkerEventType||(r.WorkerEventType={}))},{"../symbols":16}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e){e.run="run"}(r.MasterMessageType||(r.MasterMessageType={})),function(e){e.error="error",e.init="init",e.result="result",e.running="running",e.uncaughtError="uncaughtError"}(r.WorkerMessageType||(r.WorkerMessageType={}))},{}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default={isWorkerRuntime:function(){return!("undefined"==typeof self||!self.postMessage)},postMessageToMaster:function(e,t){self.postMessage(e,t)},subscribeToMasterMessages:function(e){const t=t=>{e(t.data)};return self.addEventListener("message",t),()=>{self.removeEventListener("message",t)}}}},{}],21:[function(e,t,r){(function(t){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const s=n(e("./implementation.browser")),o=n(e("./implementation.tiny-worker")),i=n(e("./implementation.worker_threads")),a=void 0!==t&&"browser"!==t.arch&&"pid"in t;r.default=a?function(){try{return i.default.testImplementation(),i.default}catch(e){return o.default}}():s.default}).call(this,e("_process"))},{"./implementation.browser":20,"./implementation.tiny-worker":1,"./implementation.worker_threads":1,_process:2}],22:[function(e,t,r){(function(t){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}u((n=n.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const o=s(e("is-observable")),i=e("../common"),a=e("../transferable"),u=e("../types/messages"),c=s(e("./implementation"));var l=e("../transferable");r.Transfer=l.Transfer;let f=!1;const d=e=>e&&e.type===u.MasterMessageType.run,p=e=>o.default(e)||function(e){return e&&"object"==typeof e&&"function"==typeof e.subscribe}(e);function h(e){return a.isTransferDescriptor(e)?{payload:e.send,transferables:e.transferables}:{payload:e,transferables:void 0}}function b(e,t){const{payload:r,transferables:n}=h(t),s={type:u.WorkerMessageType.error,uid:e,error:i.serializeError(r)};c.default.postMessageToMaster(s,n)}function m(e,t,r){const{payload:n,transferables:s}=h(r),o={type:u.WorkerMessageType.result,uid:e,complete:!!t||void 0,payload:n};c.default.postMessageToMaster(o,s)}function y(e){const t={type:u.WorkerMessageType.uncaughtError,error:i.serializeError(e)};c.default.postMessageToMaster(t)}function v(e,t,r){return n(this,void 0,void 0,(function*(){let n;try{n=t(...r)}catch(t){return b(e,t)}const s=p(n)?"observable":"promise";if(function(e,t){const r={type:u.WorkerMessageType.running,uid:e,resultType:t};c.default.postMessageToMaster(r)}(e,s),p(n))n.subscribe(t=>m(e,!1,t),t=>b(e,t),()=>m(e,!0));else try{const t=yield n;m(e,!0,t)}catch(t){b(e,t)}}))}r.expose=function(e){if(!c.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(f)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(f=!0,"function"==typeof e)c.default.subscribeToMasterMessages(t=>{d(t)&&!t.method&&v(t.uid,e,t.args)}),function(){const e={type:u.WorkerMessageType.init,exposed:{type:"function"}};c.default.postMessageToMaster(e)}();else{if("object"!=typeof e||!e)throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${e}`);c.default.subscribeToMasterMessages(t=>{d(t)&&t.method&&v(t.uid,e[t.method],t.args)}),function(e){const t={type:u.WorkerMessageType.init,exposed:{type:"module",methods:e}};c.default.postMessageToMaster(t)}(Object.keys(e).filter(t=>"function"==typeof e[t]))}},"undefined"!=typeof self&&"function"==typeof self.addEventListener&&c.default.isWorkerRuntime()&&(self.addEventListener("error",e=>{setTimeout(()=>y(e.error||e),250)}),self.addEventListener("unhandledrejection",e=>{const t=e.reason;t&&"string"==typeof t.message&&setTimeout(()=>y(t),250)})),void 0!==t&&"function"==typeof t.on&&c.default.isWorkerRuntime()&&(t.on("uncaughtException",e=>{setTimeout(()=>y(e),250)}),t.on("unhandledRejection",e=>{e&&"string"==typeof e.message&&setTimeout(()=>y(e),250)}))}).call(this,e("_process"))},{"../common":3,"../transferable":17,"../types/messages":19,"./implementation":21,_process:2,"is-observable":25}],23:[function(e,t,r){(function(n){r.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,s=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(s=n))}),e.splice(s,0,r)},r.save=function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=function(){let e;try{e=r.storage.getItem("debug")}catch(e){}!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG);return e},r.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage=function(){try{return localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=e("./common")(r);const{formatters:s}=t.exports;s.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,e("_process"))},{"./common":24,_process:2}],24:[function(e,t,r){t.exports=function(t){function r(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let t;function i(...e){if(!i.enabled)return;const r=i,s=Number(new Date),o=s-(t||s);r.diff=o,r.prev=t,r.curr=s,t=s,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(t,s)=>{if("%%"===t)return t;a++;const o=n.formatters[s];if("function"==typeof o){const n=e[a];t=o.call(r,n),e.splice(a,1),a--}return t}),n.formatArgs.call(r,e),(r.log||n.log).apply(r,e)}return i.namespace=e,i.enabled=n.enabled(e),i.useColors=n.useColors(),i.color=r(e),i.destroy=s,i.extend=o,"function"==typeof n.init&&n.init(i),n.instances.push(i),i}function s(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function o(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(i),...n.skips.map(i).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(t=0;t<s;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=e("ms"),Object.keys(t).forEach(e=>{n[e]=t[e]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=r,n.enable(n.load()),n}},{ms:26}],25:[function(e,t,r){"use strict";const n=e("symbol-observable").default;t.exports=e=>Boolean(e&&e[n]&&e===e[n]())},{"symbol-observable":42}],26:[function(e,t,r){var n=1e3,s=60*n,o=60*s,i=24*o,a=7*i,u=365.25*i;function c(e,t,r,n){var s=t>=1.5*r;return Math.round(e/r)+" "+n+(s?"s":"")}t.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*u;case"weeks":case"week":case"w":return r*a;case"days":case"day":case"d":return r*i;case"hours":case"hour":case"hrs":case"hr":case"h":return r*o;case"minutes":case"minute":case"mins":case"min":case"m":return r*s;case"seconds":case"second":case"secs":case"sec":case"s":return r*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}(e);if("number"===r&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return c(e,t,i,"day");if(t>=o)return c(e,t,o,"hour");if(t>=s)return c(e,t,s,"minute");if(t>=n)return c(e,t,n,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=s)return Math.round(e/s)+"m";if(t>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],27:[function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?s(e.value):new r((function(t){t(e.value)})).then(i,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0});r.AsyncSerialScheduler=class{constructor(e){this._baseObserver=e,this._pendingPromises=new Set}complete(){Promise.all(this._pendingPromises).then(()=>this._baseObserver.complete()).catch(e=>this._baseObserver.error(e))}error(e){this._baseObserver.error(e)}schedule(e){const t=Promise.all(this._pendingPromises),r=[],s=e=>r.push(e),o=Promise.resolve().then(()=>n(this,void 0,void 0,(function*(){yield t,yield e(s),this._pendingPromises.delete(o);for(const e of r)this._baseObserver.next(e)}))).catch(e=>{this._pendingPromises.delete(o),this._baseObserver.error(e)});this._pendingPromises.add(o)}}},{}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.hasSymbols=()=>"function"==typeof Symbol,r.hasSymbol=e=>r.hasSymbols()&&Boolean(Symbol[e]),r.getSymbol=e=>r.hasSymbol(e)?Symbol[e]:"@@"+e,r.registerObservableSymbol=function(){r.hasSymbols()&&!r.hasSymbol("observable")&&(Symbol.observable=Symbol("observable"))},r.hasSymbol("asyncIterator")||(Symbol.asyncIterator=Symbol.asyncIterator||Symbol.for("Symbol.asyncIterator"))},{}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./_symbols");r.isAsyncIterator=function(e){return e&&n.hasSymbol("asyncIterator")&&e[Symbol.asyncIterator]},r.isIterator=function(e){return e&&n.hasSymbol("iterator")&&e[Symbol.iterator]}},{"./_symbols":28}],30:[function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?s(e.value):new r((function(t){t(e.value)})).then(i,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0});const s=e("./_scheduler"),o=e("./observable"),i=e("./unsubscribe");r.default=function(e){return t=>new o.default(r=>{const o=new s.AsyncSerialScheduler(r),a=t.subscribe({complete(){o.complete()},error(e){o.error(e)},next(t){o.schedule(r=>n(this,void 0,void 0,(function*(){(yield e(t))&&r(t)})))}});return()=>i.default(a)})}},{"./_scheduler":27,"./observable":37,"./unsubscribe":40}],31:[function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?s(e.value):new r((function(t){t(e.value)})).then(i,a)}u((n=n.apply(e,t||[])).next())}))},s=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,s){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,s,(t=e[r](t)).done,t.value)}))}}};Object.defineProperty(r,"__esModule",{value:!0});const o=e("./_scheduler"),i=e("./_util"),a=e("./observable"),u=e("./unsubscribe");r.default=function(e){return t=>new a.default(r=>{const a=new o.AsyncSerialScheduler(r),c=t.subscribe({complete(){a.complete()},error(e){a.error(e)},next(t){a.schedule(r=>n(this,void 0,void 0,(function*(){var n,o;const a=yield e(t);if(i.isIterator(a)||i.isAsyncIterator(a))try{for(var u,c=s(a);!(u=yield c.next()).done;){const e=u.value;r(e)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(o=c.return)&&(yield o.call(c))}finally{if(n)throw n.error}}else a.map(e=>r(e))})))}});return()=>u.default(c)})}},{"./_scheduler":27,"./_util":29,"./observable":37,"./unsubscribe":40}],32:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./filter");r.filter=n.default;var s=e("./flatMap");r.flatMap=s.default;var o=e("./interval");r.interval=o.default;var i=e("./map");r.map=i.default;var a=e("./merge");r.merge=a.default;var u=e("./multicast");r.multicast=u.default;var c=e("./observable");r.Observable=c.default;var l=e("./scan");r.scan=l.default;var f=e("./subject");r.Subject=f.default;var d=e("./unsubscribe");r.unsubscribe=d.default},{"./filter":30,"./flatMap":31,"./interval":33,"./map":34,"./merge":35,"./multicast":36,"./observable":37,"./scan":38,"./subject":39,"./unsubscribe":40}],33:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./observable");r.default=function(e){return new n.Observable(t=>{let r=0;const n=setInterval(()=>{t.next(r++)},e);return()=>clearInterval(n)})}},{"./observable":37}],34:[function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?s(e.value):new r((function(t){t(e.value)})).then(i,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0});const s=e("./_scheduler"),o=e("./observable"),i=e("./unsubscribe");r.default=function(e){return t=>new o.default(r=>{const o=new s.AsyncSerialScheduler(r),a=t.subscribe({complete(){o.complete()},error(e){o.error(e)},next(t){o.schedule(r=>n(this,void 0,void 0,(function*(){const n=yield e(t);r(n)})))}});return()=>i.default(a)})}},{"./_scheduler":27,"./observable":37,"./unsubscribe":40}],35:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./observable"),s=e("./unsubscribe");r.default=function(...e){return 0===e.length?n.Observable.from([]):new n.Observable(t=>{let r=0;const n=e.map(n=>n.subscribe({error(e){t.error(e),o()},next(e){t.next(e)},complete(){++r===e.length&&(t.complete(),o())}})),o=()=>{n.forEach(e=>s.default(e))};return o})}},{"./observable":37,"./unsubscribe":40}],36:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./observable"),s=e("./subject"),o=e("./unsubscribe");r.default=function(e){const t=new s.default;let r,i=0;return new n.default(n=>{r||(r=e.subscribe(t));const s=t.subscribe(n);return i++,()=>{i--,s.unsubscribe(),0===i&&(o.default(r),r=void 0)}})}},{"./observable":37,"./subject":39,"./unsubscribe":40}],37:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./_symbols"),s=n.getSymbol("iterator"),o=n.getSymbol("observable"),i=n.getSymbol("species");function a(e,t){const r=e[t];if(null!=r){if("function"!=typeof r)throw new TypeError(r+" is not a function");return r}}function u(e){let t=e.constructor;return void 0!==t&&null===(t=t[i])&&(t=void 0),void 0!==t?t:y}function c(e){c.log?c.log(e):setTimeout(()=>{throw e},0)}function l(e){Promise.resolve().then(()=>{try{e()}catch(e){c(e)}})}function f(e){const t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{const e=a(t,"unsubscribe");e&&e.call(t)}}catch(e){c(e)}}function d(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function p(e,t,r){e._state="running";const n=e._observer;try{const s=n?a(n,t):void 0;switch(t){case"next":s&&s.call(n,r);break;case"error":if(d(e),!s)throw r;s.call(n,r);break;case"complete":d(e),s&&s.call(n)}}catch(e){c(e)}"closed"===e._state?f(e):"running"===e._state&&(e._state="ready")}function h(e,t,r){if("closed"!==e._state)return"buffering"===e._state?(e._queue=e._queue||[],void e._queue.push({type:t,value:r})):"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:r}],void l(()=>(function(e){const t=e._queue;if(t){e._queue=void 0,e._state="ready";for(const r of t)if(p(e,r.type,r.value),"closed"===e._state)break}})(e))):void p(e,t,r)}class b{constructor(e,t){this._cleanup=void 0,this._observer=e,this._queue=void 0,this._state="initializing";const r=new m(this);try{this._cleanup=t.call(void 0,r)}catch(e){r.error(e)}"initializing"===this._state&&(this._state="ready")}get closed(){return"closed"===this._state}unsubscribe(){"closed"!==this._state&&(d(this),f(this))}}r.Subscription=b;class m{constructor(e){this._subscription=e}get closed(){return"closed"===this._subscription._state}next(e){h(this._subscription,"next",e)}error(e){h(this._subscription,"error",e)}complete(){h(this._subscription,"complete")}}r.SubscriptionObserver=m;class y{constructor(e){if(!(this instanceof y))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof e)throw new TypeError("Observable initializer must be a function");this._subscriber=e}subscribe(e,t,r){return"object"==typeof e&&null!==e||(e={next:e,error:t,complete:r}),new b(e,this._subscriber)}pipe(e,...t){let r=this;for(const n of[e,...t])r=n(r);return r}tap(e,t,r){const n="object"!=typeof e||null===e?{next:e,error:t,complete:r}:e;return new y(e=>this.subscribe({next(t){n.next&&n.next(t),e.next(t)},error(t){n.error&&n.error(t),e.error(t)},complete(){n.complete&&n.complete(),e.complete()},start(e){n.start&&n.start(e)}}))}forEach(e){return new Promise((t,r)=>{if("function"!=typeof e)return void r(new TypeError(e+" is not a function"));function n(){s.unsubscribe(),t()}const s=this.subscribe({next(t){try{e(t,n)}catch(e){r(e),s.unsubscribe()}},error:r,complete:t})})}map(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))(t=>this.subscribe({next(r){let n=r;try{n=e(r)}catch(e){return t.error(e)}t.next(n)},error(e){t.error(e)},complete(){t.complete()}}))}filter(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))(t=>this.subscribe({next(r){try{if(!e(r))return}catch(e){return t.error(e)}t.next(r)},error(e){t.error(e)},complete(){t.complete()}}))}reduce(e,t){if("function"!=typeof e)throw new TypeError(e+" is not a function");const r=u(this),n=arguments.length>1;let s=!1,o=t;return new r(t=>this.subscribe({next(r){const i=!s;if(s=!0,!i||n)try{o=e(o,r)}catch(e){return t.error(e)}else o=r},error(e){t.error(e)},complete(){if(!s&&!n)return t.error(new TypeError("Cannot reduce an empty sequence"));t.next(o),t.complete()}}))}concat(...e){const t=u(this);return new t(r=>{let n,s=0;return function o(i){n=i.subscribe({next(e){r.next(e)},error(e){r.error(e)},complete(){s===e.length?(n=void 0,r.complete()):o(t.from(e[s++]))}})}(this),()=>{n&&(n.unsubscribe(),n=void 0)}})}flatMap(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");const t=u(this);return new t(r=>{const n=[],s=this.subscribe({next(s){let i;if(e)try{i=e(s)}catch(e){return r.error(e)}else i=s;const a=t.from(i).subscribe({next(e){r.next(e)},error(e){r.error(e)},complete(){const e=n.indexOf(a);e>=0&&n.splice(e,1),o()}});n.push(a)},error(e){r.error(e)},complete(){o()}});function o(){s.closed&&0===n.length&&r.complete()}return()=>{n.forEach(e=>e.unsubscribe()),s.unsubscribe()}})}[o](){return this}static from(e){const t="function"==typeof this?this:y;if(null==e)throw new TypeError(e+" is not an object");const r=a(e,o);if(r){const n=r.call(e);if(Object(n)!==n)throw new TypeError(n+" is not an object");return function(e){return e instanceof y}(n)&&n.constructor===t?n:new t(e=>n.subscribe(e))}if(n.hasSymbol("iterator")){const r=a(e,s);if(r)return new t(t=>{l(()=>{if(!t.closed){for(const n of r.call(e))if(t.next(n),t.closed)return;t.complete()}})})}if(Array.isArray(e))return new t(t=>{l(()=>{if(!t.closed){for(const r of e)if(t.next(r),t.closed)return;t.complete()}})});throw new TypeError(e+" is not observable")}static of(...e){return new("function"==typeof this?this:y)(t=>{l(()=>{if(!t.closed){for(const r of e)if(t.next(r),t.closed)return;t.complete()}})})}static get[i](){return this}}r.Observable=y,n.hasSymbols()&&Object.defineProperty(y,Symbol("extensions"),{value:{symbol:o,hostReportError:c},configurable:!0}),r.default=y},{"./_symbols":28}],38:[function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?s(e.value):new r((function(t){t(e.value)})).then(i,a)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(r,"__esModule",{value:!0});const s=e("./_scheduler"),o=e("./observable"),i=e("./unsubscribe");r.default=function(e,t){return r=>new o.default(o=>{let a,u=0;const c=new s.AsyncSerialScheduler(o),l=r.subscribe({complete(){c.complete()},error(e){c.error(e)},next(r){c.schedule(s=>n(this,void 0,void 0,(function*(){const n=0===u?void 0===t?r:t:a;a=yield e(n,r,u++),s(a)})))}});return()=>i.default(l)})}},{"./_scheduler":27,"./observable":37,"./unsubscribe":40}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e("./observable");class s extends n.default{constructor(){super(e=>(this._observers.add(e),()=>this._observers.delete(e))),this._observers=new Set}next(e){for(const t of this._observers)t.next(e)}error(e){for(const t of this._observers)t.error(e)}complete(){for(const e of this._observers)e.complete()}}r.default=s},{"./observable":37}],40:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){"function"==typeof e?e():e&&"function"==typeof e.unsubscribe&&e.unsubscribe()}},{}],41:[function(e,t,r){t.exports=e("./dist/index.js")},{"./dist/index.js":32}],42:[function(e,t,r){(function(n){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s,o,i=e("./ponyfill.js"),a=(s=i)&&s.__esModule?s:{default:s};o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:void 0!==t?t:Function("return this")();var u=(0,a.default)(o);r.default=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./ponyfill.js":43}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){var t,r=e.Symbol;"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable";return t}},{}]},{},[4])(4)}));